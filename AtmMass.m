function m = AtmMass(z,p)%ATMMASS - compute atmospheric mass for zenith angle%=========================================================%	m = AtmMass(z)%% From Schwindling et al. (1998) JGR, 103, 24919-24935%and%Kasten and Young (1989), Appl Optics, 28, 4735-4738%% Absolute airmass (Wikepedia)%The relative air mass is only a function of the sun's zenith angle, %and therefore does not change with local elevation. %Conversely, the absolute air mass, equal to the relative air mass %multiplied by the local atmospheric pressure and divided by the standard %(sea-level) pressure, decreases with elevation above sea level. %For solar panels installed at high altitudes, e.g. in an Altiplano region, %it is possible to use a lower absolute AM numbers than for the corresponding %latitude at sea level: AM numbers less than 1 towards the equator, %and correspondingly lower numbers than listed above for other latitudes. %However, this approach is approximate and not recommended. %It is best to simulate the actual spectrum based on the relative air mass %(e.g., 1.5) and the actual atmospheric conditions for the specific elevation of %the site under scrutiny.%input: % z = zenith angle% p = (1x1) local pressure in mbar (optional)%      %output: m = atmospheric mass% if narg = 2, use p and output absolute am.% if narg = 1, ignore p and use simply 1/cos ze%%reynolds 981105, 141211%=========================================================a = 0.50572;b = 6.07995;c = 1.6364;m = nan * ones(size(z));ix = find(z <= 89 & z >= 0 );if ix > 0	m(ix) = cos(z(ix) * pi / 180) + a .* (z(ix) + b) .^ -c;	m(ix) = 1.0 ./ m(ix);endif nargin == 2,	disp('pressure correction');	m(ix) = m(ix) * p / 1013;endreturn