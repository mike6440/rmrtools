function [handle] = trackplotsst(dtx, latx, lonx, sstx),%function [handle] = trackplotsst(dtx, latx, lonx, sstx),%  Plot any variable other than sstx. %input% dtx e.g. avc.dt% latx = latitude vector, nx1% lonx = longitude vector, nx1% sstx = temp nx1%globals%  SERIES e.g. 'cfog5' %  DTRANGE [1x2] e.g. [avc.dt(1) avc.dt(end)] %  LATRANGE [1x2] e.g. [5 50]%  LONRANGE [1x2] e.g. [130 220]%  INTERPSECS = biggest gap to be interpolated, typ. 3600%  TEMPRANGE  [1x2] e.g. [20 30]  % before calling%global SERIES DTRANGE LATRANGE LONRANGE INTERPSECS TEMPRANGE%DTRANGE=[min(sp.dt),max(sp.dt)]%LATRANGE=[min(sp.lat),max(sp.lat)]%LONRANGE=[min(sp.lon),max(sp.lon)]%TEMPRANGE=[5,35]%SERIES='series';%INTERPSECS=3600;% "addpath('/Users/rmr/swmain/matlab/crusty/m_map')"% trackplot_mapc or trackplot_mapf% NOTE:: call trackplot_mapf or trackplot_mapc beforeglobal SERIES DTRANGE LATRANGE LONRANGE INTERPSECS TEMPRANGED2R = pi/180;handle=0;%PUT LON IN THE RANGE 0 TO 360lonminmax = CompassCheck(LONRANGE);lonx = CompassCheck(lonx);	% FIND THE PERIOD OF THE SERIESdd = diff(dtx)*86400;ddp = round(median(dd));fprintf('PERIOD SECS: %.1f\n', ddp);	% TEMPERATURE SCALE = TEMRANGE;	% CLEAN LAT LON AND SST[xc,ix]=CleanSeries(latx,LATRANGE);ix=find(isnan(latx));[xc,iy]=CleanSeries(lonx,LONRANGE);iy=find(isnan(lonx));[xc,iz]=CleanSeries(sstx,TEMPRANGE);iz=find(isnan(sstx));ia=union(ix,iy);ia=union(ia,iz);latx(ia)=[]; lonx(ia)=[]; sstx(ia)=[];  dtx(ia)=[];	% TEMP DIFFERENCEfprintf('Tmin=%.1f, Tmax=%.1f\n',TEMPRANGE(1),TEMPRANGE(2));D = diff(TEMPRANGE);fprintf('TEMP DIFF = %.2f\n',D);%d = 1, 2, 5, 10;  sp = ceil(D/4);fprintf('Spread = %.1f\n',sp);t1=floor(TEMPRANGE(1)/sp)*sp;t2=t1+5*sp;fprintf('t1=%.1f, t2=%.1f\n',t1,t2);ytl=sprintf('%.0f',t1);for i=2:5,	ytl = str2mat(ytl, sprintf('%.0f',t1+(i-1)*sp));end% 1--65, 64 divisions color = 1 + 64 * (t-tmin) / (tmax-timn)% 5 divisionsytk = [1 15 30 45 65];xt = str2num(ytl); 						% convert to numberstemplim = [xt(1); xt(end)];	% LABEL OFFSETdely = 0.002 * diff(LATRANGE);delx = 0.002 * diff(LONRANGE);	%===================	% TRACKLINE	%===================	% INTERPOLATE TIME IN SECSfprintf('INTERPOLATE SECS: %.1f\n',INTERPSECS);	% FILL THE TIME SERIES, FILL GAPS WITH NANS[dtf,latf] = FillTimeSeries1sec_interp(dtx,latx,INTERPSECS,DTRANGE(1),DTRANGE(2));[dtf,lonf] = FillTimeSeries1sec_interp(dtx,lonx,INTERPSECS,DTRANGE(1),DTRANGE(2));[dtf,sstf] = FillTimeSeries1sec_interp(dtx,sstx,INTERPSECS,DTRANGE(1),DTRANGE(2));	%% GRAPH dt1 = dtf(1);  dt2 = dtf(end);% NUMBER OF DAYS TO SKIP BETWEEN DAY LABELSndaylabmax = 20;nskip = max(1, fix((dt2 - dt1)/ndaylabmax)+1);%=================% COLORMAP%=================colormap('default');cb=colorbar; ytk=(ytk-1)/64;set(cb,'ytick',ytk);set(cb,'yticklabel',ytl);set(cb,'units','normalized')set(cb,'fontsize',12)dtstart = DTRANGE(1);  dtend = DTRANGE(2);% NUMBER OF DAYS TO SKIP BETWEEN DAY LABELSndaylabmax = 10;nskip = max(1, fix((dtend - dtstart)/ndaylabmax)+1);fprintf('Skip %d days between labels\n',nskip);%===================% TRACK LINE%===================disp('plot track');clr = colormap;% isst is a color number 0-63 for all pointsisst = round(1 + 63*(sstx-templim(1))/diff(templim));ix = find(isst<1); if length(ix)>0, isst(ix)=1; endix = find(isst>64); if length(ix)>0, isst(ix)=64; end%===================% Better if we plot each point by point%===================dlat = diff(LATRANGE)/800;for i = 1:length(dtx),	dlon = diff(LONRANGE)/800  ./ cos(latx(i)*D2R);	m_line([lonx(i)-dlon,lonx(i)+dlon],[latx(i)-dlat,latx(i)+dlat],'linewi',3,'color',clr(isst(i),:) );end	% START POINTtx = m_text(lonf(1),latf(1),'o','fontweight','bold','fontsize',14);set(tx,'verticalalignment','middle','horizontalalignment','center','Color','k');	% START LABELtxstart = m_text(lonf(1)-delx, latf(1)-delx, 'START', 'fontname','arial','fontweight','bold','fontsize',14, 'color','k');set(txstart,'verticalalignment','top','horizontalalignment','right');	% all jdays	% ALL JDAYS IN THIS SEGMENTdt = fix(dtx(1))+1:fix(dtx(end));if length(dt)>0,	lat = interp1(dtx,latx,dt);	lon = interp1(dtx,lonx,dt);	for id = 1:length(dt),		txt = m_text(lon(id),lat(id),'o','fontname','arial','fontweight','bold','fontsize',14);		set(txt,'verticalalignment','middle','horizontalalignment','center');		%fprintf('day=%.2f, flag=%.2f\n',dtx(id)-dt1, rem( floor(dtx(id)-dt1), nskip));		if rem( floor(dt(id)-DTRANGE(1)), nskip) == 0,			[y,jds] = dt2jdf(dt(id));			jds = fix(jds);			tx = m_text(lon(id)+delx, lat(id)+delx, sprintf('%d',jds),'fontname','arial', 'fontweight','bold','fontsize',14);			set(tx,'verticalalignment','bottom','horizontalalignment','left');			set(tx,'fontname','arial','Color','k');		end	endendhold on;return% START POINTtx = m_line(lonx(1),latx(1)); set(tx,'marker','o','markerfacecolor','k','markeredgecolor','k');% labelstr = sprintf('START');txstart = m_text(lonx(1), latx(1)-delx, str, 'fontweight','bold','fontsize',10, 'color','black');set(txstart,'verticalalignment','top','horizontalalignment','center');nmarkdays = 3;% all jdays% ALL JDAYS IN THIS SERIESdtx = fix(dtx(1))+1:nmarkdays:fix(dtx(end))';clr = colormap;%================% CONTINUOUS GROUPS% FIND GROUPS OF FIXES SEPARATED BY GAPS OF > 24 HRS% dtx, latx, lonx are all positions. % [i1 i2] is the matrix of start/stop positions in blocks.% example:%  first "continuous" group begins at dtx(i1(1)),latx(i1(1)),lonx(i1(1)) and ends at dtx(i2(1)),latx(i2(1)),lonx(i2(1))%================maxgap=24;ix = find( diff(dtx)*24 > maxgap );if length(ix) > 0,	i1 = 1;	i1 = [i1; ix+1];	i2 = [ix; length(dtx)];	fprintf('There are %d continuous groups separated by > %d hrs',length(i1), maxgap);	[i1 i2]else	i1=1;	i2=length(dtx);end%==================% FIND ALL DATE POINTS INSIDE GROUPS% GROUPS ARE DEFINED BY [i1 i2]% DAY MARKS ARE DEFINED BY %==================idaymark=0;for i = 1 : length(i1),	ig = [i1(i):i2(i)]';	dtg=dtx(ig);	% INDEX OF JDAYS IN THIS GROUP	ix=find( dtx >= dtg(1) & dtx <= dtg(end) )';	if length(ix)>0		idaymark = [idaymark; ix];	endendidaymark(1)=[];%======================% INTERPOLATE TO THE DAY MARKS%=====================if length(idaymark) > 0,	dty = dtx(idaymark);	laty=interp1(dtx,latx,dty);	lony=interp1(dtx,lonx,dty);		%=============	% PLOT EACH DAY POINT	%=============	for j = 1:length(idaymark),		[yy,jj] = dt2jdf(dty(j));		str = sprintf('%03d', floor(jj));		tx = m_text(lony(j),laty(j), 'o', 'fontweight','bold','fontsize',10, 'color','black');		tx = m_text(lony(j),laty(j)+2*delx, str, 'fontweight','bold','fontsize',10, 'color','black');	endend% END POINTstr = 'END';tx = m_line(lonx(end),latx(end)); set(tx,'marker','o','markerfacecolor','k','markeredgecolor','k');txstart = m_text(lonx(end), latx(end)-delx, str, 'fontweight','bold','fontsize',10, 'color','black');set(txstart,'verticalalignment','top','horizontalalignment','center');str=sprintf('CRUISE %s, FROM %s TO %s',SERIES, dtstr(dtx(1)), dtstr(dtx(end)));title(str);set(gca,'fontname','helvetica','fontsize',14,'fontweight','bold');set(gca,'units','normalized','position',[0.05, 0.05, 0.8, 0.8]);return