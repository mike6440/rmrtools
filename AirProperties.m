function   [rho,Tv,q,qsat] =  AirProperties(T, RH, P)%AIRPROPERTIES --  compute density, virtual temp, specific humidity, vap press%   [rho,Tv,q] =  AirProperties(T, RH, P)%*******************************************************************%input%  T -- air temperature (C)%  RH -- %RH%  P -- barometric pressure (mbar), (optional, default = 1013)%%output%	rho -- air density (kg/m^3)%  Tv -- virtual temperature (C)%   q -- specific humidity (kg/kg)%   qs-- saturated humidity at T%reynolds 981031% v 002 rmr 061101 -- time to refresh this tired puppy%*******************************************************************if nargin == 2,  P = 1013;  end%convert T to T kelvinTk = T + 273.15 * ones(size(T));%%% COMPUTE SATURATED VAPOR PRESSURE (PA)esat = EsatWat(T);%%%% COMPUTE SATURATED MIXING RATIOwsat = 0.622 .* esat ./ (P - esat);w = (RH ./ 100) .* wsat;				% kg/kg%%%% COMPUTE THE SPECIFIC HUMIDITYq = w ./ (ones(size(w)) + w);   % kg/kgqsat = wsat ./ (ones(size(wsat)) + wsat);%%% VIRTUAL TEMPERATURE -- if degC came in, return degCTv = Tk .* (1 + 0.61 .* w);  % degK% moist air equation of staterho = (P .* 100) ./ 287 ./ Tv;  % kg/m^3Tv = Tv - 273.15 * ones(size(Tv));  % degCreturn;