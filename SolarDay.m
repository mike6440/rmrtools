function SolarDay(lat,lon,dt1,dt2)%=================================================================% function SolarDay(lat,lon,dt1,dt2)%% performs an analysis of clear sky conditions for% a period of time from dt1 to dt2.% Clear sky insolation uses SolRad and these parameters:%  watvap=3 cm, p=1013 mb,  k1 =0.03,  k2=0.03, ozone=.1% See http://aa.usno.navy.mil/data/docs/RS_OneYear.php% reynolds 121218% ====================================================================		%TEST%clear, %%lat = 25.42475; lon= -144.57570;%%lat = 0; lon= 0;%lat = 35.9; lon=-106.2;%dt1=datenum(2012,6,21);%dt2=dt1+4; %days%%PROGRAM SolarDay() -- run time 24-Apr-2017 12:36:37%Lat/lon = 0.00000 / 0.00000.  All times are local daylight time.% yyyy MM dd       RISE     AZ        NOON     AZ  EL        SET      AZ   SW-CLEAR%2012-03-18      06:04:43  091      12:07:57  180   1      18:11:10  269   604.79%2012-03-19      06:04:25  090      12:07:54  193   0      18:10:53  270   604.83%2012-03-20      06:04:07  090      12:07:06  151   0      18:10:35  270   604.83%2012-03-21      06:03:50  090      12:07:03  180   0      18:10:17  269   604.81%2012-03-22      06:03:32  091      12:06:54  182   1      18:09:59  269   604.74		% END TESTndays = fix(dt2-dt1)+1;fprintf('\nPROGRAM SolarDay() -- run time %s\n',datestr(now));fprintf('Lat/lon = %.5f / %.5f.  All times are local daylight time.\n', lat, lon);%         2012-12-18      06:18:36  064      11:35:06  000  49      16:51:59  296fprintf(' yyyy MM dd       RISE     AZ        NOON     AZ  ZE        SET      AZ   SW-CLEAR\n');dtx=dt1;for idy = 1:ndays,			% TIMES AT RISE, NOON, SET	[y,M,d] = datevec(dtx); 	[tr,tn,ts,tzone] = apnoon(y,M,d,lat,lon);	% utc times of sunrise, sunset, and noon			% AZIMUTH ANGLES	ar = ephem(lat,lon,tr);  	as = ephem(lat,lon,ts);	[an,zn] = ephem(lat,lon,tn);			% EACH MINUTE OF DAYLIGHT	tx=tr;	sw=0; nsw=0;	while tx <= ts,		% SW AT THAT MINUTE		sw = sw + SolRad(lat,lon, tx, 3, 1013, .03, .03, .1);		nsw=nsw+1;		tx = tx + 1/1440;	end			% AVERAGE INSOLATION	sw = sw / nsw;	fprintf('%s      %s  %03.0f      %s  %03.0f  %2.0f      %s  %03.0f   %6.2f\n', ...		dtstr(dtx+tzone/24,'date'), dtstr(tr+tzone/24,'time'), ar,  ...		dtstr(tn+tzone/24,'time'), an, zn, dtstr(ts+tzone/24,'time'), as, sw);	dtx=dtx+1;endreturn